@{
    /*****************************************************************************
    1. Create Date : 2017.06.29
    2. Creator     : Nguyen Thanh Binh
    3. Description : khophieunhap/edit
    4. History     : 2017.06.29 (Nguyen Thanh Binh) - thiết kế giao diện
    *****************************************************************************/
    ViewBag.Title = "Thông tin phiếu xuất kho";
    ViewBag.id = ViewBag.id ?? 0;
    ViewBag.userInfo = ViewBag.userInfo ?? "{ }";
}
<div class="container-fluid" ng-controller="MainEditCtrl as mainCtrl" ng-init="mainCtrl.onInitView()" keyboard="mainCtrl.keys">
    <div class="panel panel-default" ng-controller="KhoPhieuXuatEditCtrl as ctrl" ng-init="ctrl.onInitView({controllerId:mainCtrl.controllerId.KhoPhieuXuatEdit,isEdit:@(ViewBag.isEdit),phieuXuatId:@(ViewBag.id),userInfo:@(ViewBag.userInfo),linkUrl:'@(Url.Content("~/"))'})">
        <div class="panel-heading">
            <span class="panel-title"><i class="fa fa-fw fa-star-o"></i> Phiếu xuất kho</span>
        </div>
        <div class="panel-body">
            <div class="text-center">
                <h4>Phiếu xuất kho (xuất bán)</h4>
                <span class="text-capitalize" ng-bind="ctrl.data.fullDateString"></span>
            </div>
        </div>

        <div class="panel-body">
            <form class="form-horizontal">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group form-group-sm" ng-class="ctrl.error.SoHoaDon?'has-error':''">
                            <label class="control-label col-sm-2">Loại phiếu</label>
                            <div class="col-sm-10">
                                <label class="radio-inline" ng-repeat="item in ctrl.data.listLoaiPhieuXuat track by $index">
                                    <input type="radio" value="{{item.MaTrangThai}}" ng-model="ctrl.data.phieuXuat.LoaiPhieu" />
                                    <span ng-bind="item.TrangThai"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group form-group-sm" ng-class="ctrl.error.NguoiNhanHang?'has-error':''">
                            <label class="control-label col-sm-4">Người nhận hàng</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" ng-model="ctrl.data.phieuXuat.NguoiNhanHang" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="NguoiNhanHang" data-next="SoDienThoai" autofocus />
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 form-inline">
                        <div class="form-group form-group-sm" ng-class="ctrl.error.SoDienThoai?'has-error':''">
                            <label class="control-label">ĐT</label>
                            <input type="text" class="form-control" style="width:150px" ng-model="ctrl.data.phieuXuat.SoDienThoai" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="SoDienThoai" data-next="TenKhachHang" autofocus />
                        </div>
                        <div class="form-group form-group-sm" ng-class="ctrl.error.SoPhieu?'has-error':''">
                            <label class="control-label">Số</label>
                            @*<span type="text" class="form-control" placeholder="NMddmmyy-No" ng-if="ctrl.getPhieuXuatId()>0" ng-bind="ctrl.data.phieuXuat.SoPhieu" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="SoPhieu" data-next="TenKhachHang"></span>*@
                            <div class="input-group input-group-sm" @*ng-if="ctrl.getPhieuXuatId()==0"*@>
                                <input type="text" class="form-control" style="width:150px" placeholder="XBddmmyy-No" ng-model="ctrl.data.phieuXuat.SoPhieu" />
                                <a class="btn input-group-addon" href="javascript:void(0)" ng-click="ctrl.action.getSoPhieu()" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="SoPhieu" data-next="TenKhachHang"><i class="fa fa-fw fa-refresh"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row form-group form-group-sm" ng-class="ctrl.error.TenKhachHang?'has-error':''">
                    <label class="control-label col-sm-2">Đơn vị</label>
                    <div class="col-sm-10">
                        <div class="form-control auto-height">
                            <a class="pull-right" href="javascript:void(0)" tabindex="-1" ng-click="ctrl.action.clearKhachHang()"><i class="fa fa-fw fa-remove"></i></a>
                            <a href="javascript:void(0)" data-target="#KhachHangListPopup" data-toggle="collapse" -keypress="ctrl.action.keyPressEnter($event)" data-name="TenKhachHang" data-next="Seri">
                                <div>
                                    <i class="fa fa-fw fa-search"></i>
                                    <span class="" style="margin-right: 5px;" ng-bind="ctrl.data.phieuXuat.TenKhachHang"></span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
                <!--<div class="row form-group form-group-sm" ng-class="ctrl.error.DiaChi?'has-error':''">-->
                <div class="row form-group form-group-sm" >
                    <label class="control-label col-sm-2">Địa chỉ</label>
                    <div class="col-sm-10">
                        <input class="form-control" ng-model="ctrl.data.phieuXuat.DiaChi" />
                    </div>
                </div>
               
               
                <div class="row">
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.TenKhoXuat?'has-error':''">
                            <label class="control-label col-sm-4">Kho xuất</label>
                            <div class="col-sm-8">
                                <div class="form-control auto-height" ng-if="ctrl.action.checkQuyenTacVu('N')">
                                    <a class="pull-right" href="javascript:void(0)" tabindex="-1" ng-click="ctrl.action.clearkhoXuat()"><i class="fa fa-fw fa-remove"></i></a>
                                    <a href="javascript:void(0)" data-target="#{{mainCtrl.controllerId.KhoKhoHangListPopup}}" data-toggle="collapse" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="TenKhoXuat" data-next="strNgayXuat">
                                        <div>
                                            <i class="fa fa-fw fa-search"></i>
                                            <span class="" style="margin-right: 5px;" ng-bind="ctrl.data.phieuXuat.TenKhoXuat"></span>
                                        </div>
                                    </a>
                                </div>
                                <span class="form-control auto-height" ng-if="ctrl.action.checkQuyenTacVu('N') == false" ng-bind="ctrl.data.phieuXuat.TenKhoXuat"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.strNgayXuat?'has-error':''">
                            <label class="control-label col-sm-4">Ngày xuất</label>
                            <div class="col-sm-8">
                                <input type="text" style="width:120px;" class="form-control datetimepicker date" ng-model="ctrl.data.phieuXuat.strNgayXuat" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="strNgayXuat" data-next="TenThuKho" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row form-group form-group-sm" ng-class="ctrl.error.NoiDung?'has-error':''">
                    <label class="control-label col-sm-2">Nội dung</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" ng-model="ctrl.data.phieuXuat.NoiDung" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="NoiDung" data-next="TenTaiKhoanCo" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4">
                        <!--<div class="form-group form-group-sm" ng-class="ctrl.error.SoHoaDon?'has-error':''">-->
                        <div class="form-group form-group-sm" >
                            <label class="control-label col-sm-6">Số hóa đơn</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" ng-model="ctrl.data.phieuXuat.SoHoaDon" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="SoHoaDon" data-next="Seri" />
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-8 form-inline">
                        <!--div class="form-group form-group-sm" ng-class="ctrl.error.Seri?'has-error':''">-->
                            <div class="form-group form-group-sm">
                                <label class="form-label">Seri</label>
                                <input type="text" class="form-control" style="width:120px;" ng-model="ctrl.data.phieuXuat.Seri" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="Seri" data-next="strNgayChungTu" />
                            </div>
                        <!--<div class="form-group form-group-sm" ng-class="ctrl.error.strNgayChungTu?'has-error':''">-->
                            <div class="form-group form-group-sm">
                                <label class="form-label">Ngày CT</label>
                                <input type="text" class="form-control datetimepicker date" style="width:120px;" ng-model="ctrl.data.phieuXuat.strNgayChungTu" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="strNgayChungTu" data-next="NoiDung" />
                            </div>
                        <!--<div class="form-group form-group-sm" ng-class="ctrl.error.strNgayThanhToan?'has-error':''">-->
                            <div class="form-group form-group-sm">
                                <label class="form-label">Ngày thanh toán</label>
                                <input type="text" style="width:120px;" class="form-control datetimepicker date" ng-model="ctrl.data.phieuXuat.strNgayThanhToan" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="strNgayThanhToan" data-next="strNgayThanhToan" />
                            </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.MaTaiKhoanCo?'has-error':''">
                            <label class="control-label col-sm-4">Tài khoản có</label>
                            <div class="col-sm-8">
                                <div class="form-control auto-height">
                                    <a class="pull-right" href="javascript:void(0)" tabindex="-1" ng-click="ctrl.data.phieuXuat.TaiKhoanCo=0;ctrl.data.phieuXuat.MaTaiKhoanCo=''"><i class="fa fa-fw fa-remove"></i></a>
                                    <a href="javascript:void(0)" data-target="#{{mainCtrl.controllerId.KhoTaiKhoanCoListPopup}}" data-toggle="collapse" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="TenTaiKhoanCo" data-next="TenTaiKhoanNo">
                                        <div>
                                            <i class="fa fa-fw fa-search"></i>
                                            <span class="" style="margin-right: 5px;" ng-bind="ctrl.data.phieuXuat.MaTaiKhoanCo"></span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.MaTaiKhoanNo?'has-error':''">
                            <label class="control-label col-sm-4">Tài khoản nợ</label>
                            <div class="col-sm-8">
                                <div class="form-control auto-height">
                                    <a class="pull-right" href="javascript:void(0)" tabindex="-1" ng-click="ctrl.data.phieuXuat.TaiKhoanNo=0;ctrl.data.phieuXuat.MaTaiKhoanNo=''"><i class="fa fa-fw fa-remove"></i></a>
                                    <a href="javascript:void(0)" data-target="#{{mainCtrl.controllerId.KhoTaiKhoanNoListPopup}}" data-toggle="collapse" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="TenTaiKhoanNo" data-next="TenKhoXuat">
                                        <div>
                                            <i class="fa fa-fw fa-search"></i>
                                            <span class="" style="margin-right: 5px;" ng-bind="ctrl.data.phieuXuat.MaTaiKhoanNo"></span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.MaTaiKhoanKho?'has-error':''">
                            <label class="control-label col-sm-4">Tài khoản kho</label>
                            <div class="col-sm-8">
                                <div class="form-control auto-height">
                                    <a class="pull-right" href="javascript:void(0)" tabindex="-1" ng-click="ctrl.data.phieuXuat.TaiKhoanKho=0;ctrl.data.phieuXuat.MaTaiKhoanKho=''"><i class="fa fa-fw fa-remove"></i></a>
                                    <a href="javascript:void(0)" data-target="#{{mainCtrl.controllerId.KhoTaiKhoanKhoListPopup}}" data-toggle="collapse" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="MaTaiKhoanKho" data-next="MaTaiKhoanGiaVon">
                                        <div>
                                            <i class="fa fa-fw fa-search"></i>
                                            <span class="" style="margin-right: 5px;" ng-bind="ctrl.data.phieuXuat.MaTaiKhoanKho"></span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.MaTaiKhoanGiaVon?'has-error':''">
                            <label class="control-label col-sm-4">Tài khoản giá vốn</label>
                            <div class="col-sm-8">
                                <div class="form-control auto-height">
                                    <a class="pull-right" href="javascript:void(0)" tabindex="-1" ng-click="ctrl.data.phieuXuat.TaiKhoanGiaVon=0;ctrl.data.phieuXuat.MaTaiKhoanGiaVon=''"><i class="fa fa-fw fa-remove"></i></a>
                                    <a href="javascript:void(0)" data-target="#{{mainCtrl.controllerId.KhoTaiKhoanGiaVonListPopup}}" data-toggle="collapse" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="MaTaiKhoanGiaVon" data-next="MaTaiKhoanGiaVon">
                                        <div>
                                            <i class="fa fa-fw fa-search"></i>
                                            <span class="" style="margin-right: 5px;" ng-bind="ctrl.data.phieuXuat.MaTaiKhoanGiaVon"></span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.TenThuKho?'has-error':''">
                            <label class="control-label col-sm-4">Thủ kho</label>
                            <div class="col-sm-8">
                                <div class="form-control auto-height">
                                    <a class="pull-right" href="javascript:void(0)" tabindex="-1" ng-click="ctrl.action.clearThuKho()"><i class="fa fa-fw fa-remove"></i></a>
                                    <a href="javascript:void(0)" data-target="#{{mainCtrl.controllerId.ThuKhoListPopup}}" data-t data-toggle="collapse" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="TenThuKho" data-next="TenNguoiGiaoHang">
                                        <div>
                                            <i class="fa fa-fw fa-search"></i>
                                            <span class="" style="margin-right: 5px;" ng-bind="ctrl.data.phieuXuat.TenThuKho"></span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.TenNguoiGiaoHang?'has-error':''">
                            <label class="control-label col-sm-4">Người giao hàng</label>
                            <div class="col-sm-8">
                                <div class="form-control auto-height">
                                    <a class="pull-right" href="javascript:void(0)" tabindex="-1" ng-click="ctrl.action.clearNguoiGiaoHang()"><i class="fa fa-fw fa-remove"></i></a>
                                    <a href="javascript:void(0)" data-target="#{{mainCtrl.controllerId.NguoiGiaoHangListPopup}}" data-toggle="collapse" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="TenNguoiGiaoHang" data-next="TenNguoiGiaoHang">
                                        <div>
                                            <i class="fa fa-fw fa-search"></i>
                                            <span class="" style="margin-right: 5px;" ng-bind="ctrl.data.phieuXuat.TenNguoiGiaoHang"></span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="row form-group form-group-sm" ng-class="ctrl.error.Hinh?'has-error':''">
                            <label class="control-label col-sm-4">Hình</label>
                            <div class="col-sm-8">
                                <input type="file" class="form-control" file-bind="ctrl.data.file" accept="image/*" />
                                @*<a href="javascript:void(0)" ng-click="ctrl.action.upload()">upload</a>*@
                                <a href="@(Url.Content("~/content/upload/")){{ctrl.data.phieuXuat.Hinh}}" target="_blank" ng-if="ctrl.data.phieuXuat.Hinh">Xem hình</a>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            @*<a class="btn btn-sm btn-primary" href="javascript:void(0)" data-toggle="collapse" data-target="#{{mainCtrl.controllerId.KhoHangHoaListPopup}}" ng-if="ctrl.action.checkQuyenTacVu('N')||ctrl.action.checkQuyenTacVu('M')">
                <i class="fa fa-fw fa-plus"></i>
                Thêm chi tiết (F2)
            </a>*@
            <button class="btn btn-sm btn-primary" ng-click="ctrl.action.emitKhoXuatId()"><i class="fa fa-fw fa-plus"></i>Thêm chi tiết (F2)</button>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered table-condensed table-hover table-striped">
                <thead class="text-primary">
                    <tr>
                        <th class="text-center" style="width:20px;">#</th>
                        <th class="text-center" style="width:40px;">Xóa</th>
                        <th class="text-center" style="width:100px;">Mã hàng hóa</th>
                        <th class="text-center">Tên hàng hóa</th>
                        <th class="text-center" style="width:50px;">Lô</th>
                        <th class="text-center" style="width:50px;">BH</th>
                        <th class="text-center" style="width:50px;">ĐVT</th>
                        <th class="text-center" style="width:120px;">Giá nhập</th>
                        <th class="text-center" style="width:50px;">Số lượng</th>
                        <th class="text-center" style="width:120px;">Giá bán</th>
                        <th class="text-center" style="width:150px;">Thành tiền</th>
                        <th class="text-center" style="width:50px;">series</th>
                        <th class="text-center" style="width:0px;"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="chitiet in ctrl.data.listChiTiet track by $index">
                        <td class="text-center" ng-bind="{{$index+1}}"></td>
                        <td class="text-center"><a class="btn btn-xs btn-danger" ng-click="ctrl.data.listChiTiet.splice($index,1)" ng-if="ctrl.action.checkQuyenTacVu('N')||ctrl.action.checkQuyenTacVu('M')"><i class="fa fa-fw fa-remove"></i></a></td>
                        <td class="form-group form-group-sm">
                            <div class="form-control auto-height">
                                <span ng-bind="chitiet.MaHangHoa">Hàng hóa</span>
                            </div>
                        </td>
                        <td class="form-group form-group-sm">
                            <span class="form-control auto-height" ng-bind="chitiet.TenHangHoa"></span>
                        </td>
                        <td class="form-group form-group-sm">
                            <span class="form-control text-right" ng-bind="chitiet.LoHang"></span>
                        </td>
                        <td class="form-group form-group-sm">
                            <input type="text" class="form-control text-right" ng-model="chitiet.ThoiGianBaoHanh" number-format />
                        </td>
                        <td class="form-group form-group-sm">
                            <span class="form-control text-right" ng-bind="chitiet.DonViTinh"></span>
                        </td>
                        <td class="form-group form-group-sm">
                            <span class="form-control text-right" ng-bind="chitiet.GiaNhap|number"></span>
                        </td>
                        <td class="form-group form-group-sm">
                            <input type="text" class="form-control text-right" maxlength="3" ng-model="chitiet.SoLuong" number-format ng-change="ctrl.action.tinhThue()" />
                        </td>
                        <td class="form-group form-group-sm">
                            <input type="text" class="form-control text-right" maxlength="15" ng-model="chitiet.DonGia" number-format ng-change="ctrl.action.tinhThue()" />
                        </td>
                        <td class="form-group form-group-sm">
                            <span class="form-control text-right" ng-bind="chitiet.SoLuong*chitiet.DonGia|number:'':'':2"></span>
                        </td>
                        <td class="form-group form-group-sm">
                            <a class="btn btn-sm btn-primary" href="javascript:void(0)" ng-click="ctrl.action.NhapSeries(chitiet)">
                                <i class="fa fa-barcode" aria-hidden="true"></i>
                                <!--series-->
                            </a>
                        </td>
                        
                        <td class="form-group form-group-sm">
                            <a ng-if="ctrl.action.checkQuyenTacVu2('L')" class="btn btn-sm btn-primary" href="javascript:void(0)" ng-click="ctrl.action.updateSaukhiLuuSoCai(chitiet)">
                                <i class="fa fa-save" aria-hidden="true"></i>
                                Lưu
                            </a>
                        </td>
                        
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td class="text-right" colspan="10">Tổng cộng tiền hàng</td>
                        <td class="text-right" ng-bind="ctrl.data.tienHang=(ctrl.data.listChiTiet | totalSumPriceQty:'SoLuong':'DonGia')|number:'':'':2"></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td class="text-right" colspan="10">Chi phí</td>
                        <td class="form-group form-group-sm">
                            <input class="form-control text-right" type="text" maxlength="12" ng-model="ctrl.data.phieuXuat.ChiPhi" number-format />
                        </td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td class="text-right" colspan="10">Thuế giá trị gia tăng (%)</td>
                        <td class="form-group form-group-sm">
                            <input class="form-control text-right" type="text" maxlength="3" ng-model="ctrl.data.phieuXuat.ThueVAT" number-format ng-change="ctrl.action.tinhThue()" />
                        </td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td class="text-right" colspan="10">Tiền thuế</td>
                        <td class="form-group form-group-sm">
                            <input class="form-control text-right" type="text" ng-model="ctrl.data.phieuXuat.TienThue" number-format />
                        </td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td class="text-right" colspan="10"><b>Tổng cộng tiền thanh toán</b></td>
                        <td class="text-right"><b ng-bind="(ctrl.data.tienHang*1+ctrl.data.phieuXuat.ChiPhi*1+ctrl.data.phieuXuat.TienThue*1)|number:'':'':2"></b></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="panel-body"></div>
        <div class="panel-footer">
            <span ng-if="ctrl.action.checkQuyenTacVu('N')||ctrl.action.checkQuyenTacVu('M')">
                <a class="btn btn-sm btn-primary" href="javascript:void(0)" ng-click="ctrl.action.save()"><i class="fa fa-fw fa-save"></i> Lưu (F8)</a>&nbsp;&nbsp;&nbsp;
            </span>
            <span ng-if="ctrl.action.checkQuyenTacVu('D')">
                <a class="btn btn-sm btn-default" href="javascript:void(0)" ng-click="ctrl.action.removePhieuXuat()"><i class="fa fa-fw fa-remove"></i> Xóa</a>&nbsp;&nbsp;&nbsp;
            </span>
            <a class="btn btn-sm btn-default" ng-click="ctrl.action.goBack()"><i class="fa fa-fw fa-refresh"></i> Quay lại</a>&nbsp;&nbsp;&nbsp;
            <span ng-if="ctrl.action.checkQuyenTacVu('L')">
                <a class="btn btn-sm btn-default" href="javascript:void(0)" ng-click="ctrl.action.luuSoCai()"><i class="fa fa-fw fa-lock"></i> Khóa phiếu</a>&nbsp;&nbsp;&nbsp;
            </span>
            <a class="btn btn-sm btn-default" href="javascript:void(0)" ng-click="ctrl.action.In()"><i class="fa fa-fw fa-print"></i> In</a>&nbsp;&nbsp;&nbsp;
            <a class="btn btn-sm btn-default" href="javascript:void(0)" ng-click="ctrl.action.xemLuocSu()">H</a>&nbsp;&nbsp;&nbsp;
        </div>

        <div class="panel panel-primary hidden-print collapse fade ui-draggable" id="SerialHangHoaPop">
            <div class="panel-heading ui-draggable-handle">
                <div class="panel-title">
                    <span>Danh sách nhập series hàng hóa</span>
                    <a class="btn btn-xs btn-primary pull-right" data-toggle="collapse" data-target="#SerialHangHoaPop"><i class="fa fa-fw fa-remove"></i></a>
                </div>
            </div>
            <div class="panel-body" style="max-height:550px">

                <table class="table table-bordered table-condensed table-responsive table-hover ">
                    <thead class="bg-default text-primary">
                        <tr>
                            <th class="text-center" style="width: 50px;">#</th>
                            <th class="text-center">series</th>
                            <th class="text-center">Mã hàng hóa</th>
                            <th class="text-center">Tên hàng</th>
                            <th class="text-center">ĐVT</th>
                            <th class="text-center">Giá bán</th>
                            <th class="text-center">Bảo hành(tháng)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="chitiet in ctrl.data.listSeries track by $index">
                            <td class="text-center " ng-bind="{{$index+1}}"></td>
                            <td class="form-group form-group-sm">
                                <input type="text" id="Series{{$index+1}}" class="form-control text-right" ng-class="chitiet.error?'text-red':''" ng-model="chitiet.Series" ng-blur="ctrl.action.changeSeries($index)" ng-keypress="ctrl.action.keyPressEnter($event)" data-name="Series{{$index+1}}" data-next="Series{{$index+2}}" />
                            </td>
                            <td class="form-group form-group-sm">
                                <div class="form-control">
                                    <span ng-bind="chitiet.MaHangHoa">Hàng hóa</span>
                                </div>
                            </td>
                            <td class="form-group form-group-sm">
                                <span class="form-control auto-height" ng-bind="chitiet.TenHangHoa"></span>
                            </td>
                            <td class="form-group form-group-sm">
                                <span class="form-control text-right" ng-bind="chitiet.DonViTinh"></span>
                            </td>
                            <td class="form-group form-group-sm">
                                <span class="form-control text-right" ng-bind="chitiet.DonGia"></span>
                            </td>
                            <td class="form-group form-group-sm">
                                <input type="text" min="0" maxlength="3" class="form-control" id="txtBaoHanh" ng-model="chitiet.ThoiGianBaoHanh" number-format>
                            </td>
                        </tr>


                    </tbody>

                </table>

            </div>
            <div class="panel-footer">
                <span ng-if="ctrl.action.checkQuyenTacVu('N')||ctrl.action.checkQuyenTacVu('M')">
                    <button class="btn btn-sm btn-primary" ng-click="ctrl.action.LuuSerial()">Lưu</button>&nbsp;&nbsp;&nbsp;
                </span>

                <button class="btn btn-sm btn-default" data-toggle="collapse" data-target="#SerialHangHoaPop">Đóng</button>
            </div>
        </div>
    </div>
    <!-- popup danh sách khách hàng -->
    <div class="panel panel-primary hidden-print collapse fade ui-draggable" ng-controller="KhachHangListCtrl as ctrl" id="{{mainCtrl.controllerId.KhachHangListPopup}}" ng-init="ctrl.onInitView({controllerId:'KhachHangListPopup'})">
        <div class="panel-heading ui-draggable-handle">
            <div class="panel-title">
                <span>Danh sách nhà cung cấp</span>
                <a class="btn btn-xs btn-primary pull-right" data-toggle="collapse" data-target="#{{mainCtrl.controllerId.KhachHangListPopup}}"><i class="fa fa-fw fa-remove"></i></a>
            </div>
        </div>
        <div class="panel-body" style="width:auto; height:auto;">
            <form class="form-inline">
                <div class="form-group form-group-sm">
                    <span><i class="fa fa-fw fa-star-o"></i>Tìm kiếm khách hàng</span>
                </div>
                <div class="form-group form-group-sm">
                    <div class="input-group input-group-sm">
                        <input class="form-control" ng-model="ctrl.data.searchString" autofocus />
                        <span class="input-group-btn">
                            <button class="btn btn-sm btn-primary" ng-click="ctrl.action.getPage()"><i class="fa fa-fw fa-search"></i>Tìm kiếm</button>
                        </span>
                    </div>
                </div>
            </form>
        </div>
        <div class="table-responsive" style="height: 400px;">
            <table st-table="ctrl.data.listKhachHang" st-pipe="ctrl.action.getPage" class="table table-bordered table-condensed table-hover table-striped">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 50px;"></th>
                        <th class="text-center" style="width: 100px;" st-sort="MA">Mã</th>
                        <th class="text-center" style="width: 200px" st-sort="TEN">Tên</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-if="ctrl.status.isLoading">
                        <td colspan="100" class="text-center">
                            <i class="fa fa-fw fa-spin fa-spinner"></i>
                        </td>
                    </tr>
                    <tr ng-repeat="kh in ctrl.data.listKhachHang" ng-class="(kh.isSelected==true)?'info':''">
                        <td st-select-row="kh" st-select-mode="" class="text-center"><i class="fa fa-fw text-primary" ng-class="(kh.isSelected==true)?'fa-check-square-o':'fa-square-o'"></i></td>
                        <td><a ng-bind="kh.MA" href="javascript:void(0);"></a></td>
                        <td><span ng-bind="kh.TEN"></span></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="100" class="text-center">
                            <div st-pagination="" st-items-by-page="10" st-template="~/Scripts/angular/shared/smart-table/template/pagination.custom.html"></div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="panel-footer">
            <button class="btn btn-sm btn-primary" ng-click="ctrl.action.apDung()">Áp dụng</button>
            <button class="btn btn-sm btn-default" data-toggle="collapse" data-target="#{{mainCtrl.controllerId.KhachHangListPopup}}">Đóng</button>
        </div>
    </div><!-- /popup danh sách khách hàng -->
    <!-- popup danh sách hàng hóa -->
    <div class="panel panel-primary hidden-print collapse fade ui-draggable" ng-controller="KhoHangHoaListPopCtrl as ctrl" id="{{mainCtrl.controllerId.KhoHangHoaListPopup}}" ng-init="ctrl.onInitView({controllerId:'KhoHangHoaListPopup',loai:'1'})">
        <div class="panel-heading ui-draggable-handle">
            <div class="panel-title">
                <span>Danh sách hàng hóa</span>
                <a class="btn btn-xs btn-primary pull-right" data-toggle="collapse" data-target="#{{mainCtrl.controllerId.KhoHangHoaListPopup}}"><i class="fa fa-fw fa-remove"></i></a>
            </div>
        </div>
        <div class="panel-body" style="width:auto; height:auto;">
            <form class="form-inline">
                <div class="form-group form-group-sm">
                    <span><i class="fa fa-fw fa-star-o"></i>Tìm kiếm hàng hóa</span>
                </div>
                <div class="form-group form-group-sm">
                    <div class="input-group input-group-sm">
                        <input class="form-control" ng-model="ctrl.data.searchString" autofocus />
                        <span class="input-group-btn">
                            <button class="btn btn-sm btn-primary" ng-click="ctrl.action.getPage()"><i class="fa fa-fw fa-search"></i>Tìm kiếm</button>
                        </span>
                    </div>
                </div>
            </form>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered table-condensed table-responsive table-hover " st-table="ctrl.data.listKhoHangHoa" st-pipe="ctrl.action.getPage">
                <thead class="bg-default text-primary">
                    <tr>
                        <th class="text-center" style="width: 50px;">Chọn</th>
                        <th class="text-center" st-sort="MaHangHoa">Mã hàng</th>
                        <th class="text-center" st-sort="TenHangHoa">Tên hàng</th>
                        <th class="text-center" st-sort="DonGiaNhap">Lô</th>
                        <th class="text-center" st-sort="DonGiaNhap">Giá nhập</th>
                        @*<th class="text-center" st-sort="DonGiaXuat">Giá bán</th>*@
                        @*<th class="text-center" st-sort="TonKho">Tồn kho</th>*@
                        <th class="text-center" st-sort="{{cot.MaKho}}" ng-repeat="cot in ctrl.data.listKhoHang|filter:cot.KhoHangId" ng-bind="::cot.TenKho"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="tonkho in ctrl.data.listKhoHangHoa">
                        <td st-select-row="tonkho" st-select-mode="multiple" class="text-center"><i class="fa fa-fw text-primary" ng-class="(tonkho.isSelected==true)?'fa-check-square-o':'fa-square-o'"></i></td>
                        <td><a href="javascript:void(0)" ng-bind="tonkho.MaHangHoa"></a></td>
                        <td><a href="javascript:void(0)" ng-bind="tonkho.TenHangHoa"></a></td>
                        <td ng-bind="tonkho.LoHang"></td>
                        <td style="text-align:right"><span ng-bind="tonkho.DonGiaNhap"></span></td>
                        @*<td style="text-align:right"><span ng-bind="tonkho.DonGiaXuat"></span></td>*@
                        @*<td style="text-align:right"><span ng-bind="tonkho.TonKho"></span></td>*@
                        <td style="text-align:right" ng-repeat="cot in ctrl.data.listKhoHang|filter:cot.KhoHangId" ng-switch="cot.TenKho">
                            <span ng-switch-default ng-bind="::tonkho[cot.MaKho]"></span>
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="100" class="text-center hidden-print">
                            <div st-pagination="" st-items-by-page="10" st-template="~/Scripts/angular/shared/smart-table/template/pagination.custom.html">
                            </div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="panel-footer">
            <button class="btn btn-sm btn-primary" ng-click="ctrl.action.apDung()">Áp dụng</button>
            <button class="btn btn-sm btn-default" data-toggle="collapse" data-target="#{{mainCtrl.controllerId.KhoHangHoaListPopup}}">Đóng</button>
        </div>
    </div><!-- /popup danh sách hàng hóa -->
    <div class="modal fade bs-example-modal-full" id="reportmodal" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-full" style="margin: 0px; width:90%">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myLargeModalLabel">Phiếu xuất kho</h4>
                </div>
                <div class="modal-body">
                    <iframe src="" width="100%" height="1000px"></iframe>
                </div>
            </div>
        </div>
    </div>
    <!-- /popup danh sách hàng hóa -->
    <!-- popup danh sách tài khoản có -->
    @{Html.RenderPartial("~/views/KhoTaiKhoan/_TaiKhoanListPopup.cshtml", new ViewDataDictionary { { "Html", true }, { "onInitView", "{controllerId:mainCtrl.controllerId.KhoTaiKhoanCoListPopup,title:'Tài khoản có'}" } });}
    <!-- popup danh sách tài khoản nợ -->
    @{Html.RenderPartial("~/views/KhoTaiKhoan/_TaiKhoanListPopup.cshtml", new ViewDataDictionary { { "Html", true }, { "onInitView", "{controllerId:mainCtrl.controllerId.KhoTaiKhoanNoListPopup,title:'Tài khoản nợ'}" } });}
    <!-- popup danh sách tài khoản kho -->
    @{Html.RenderPartial("~/views/KhoTaiKhoan/_TaiKhoanListPopup.cshtml", new ViewDataDictionary { { "Html", true }, { "onInitView", "{controllerId:mainCtrl.controllerId.KhoTaiKhoanKhoListPopup,title:'Tài khoản kho'}" } });}
    <!-- popup danh sách tài khoản giá vốn -->
    @{Html.RenderPartial("~/views/KhoTaiKhoan/_TaiKhoanListPopup.cshtml", new ViewDataDictionary { { "Html", true }, { "onInitView", "{controllerId:mainCtrl.controllerId.KhoTaiKhoanGiaVonListPopup,title:'Tài khoản giá vốn'}" } });}

    @{Html.RenderPartial("~/views/NhanVien/_NhanVienListPopup.cshtml", new ViewDataDictionary { { "Html", true }, { "onInitView", "{controllerId:mainCtrl.controllerId.ThuKhoListPopup,isSelectOne:true,showList:true,title:'Thủ kho'}" } });}
    @{Html.RenderPartial("~/views/NhanVien/_NhanVienListPopup.cshtml", new ViewDataDictionary { { "Html", true }, { "onInitView", "{controllerId:mainCtrl.controllerId.NguoiGiaoHangListPopup,isSelectOne:true,showList:true,title:'Người giao hàng'}" } });}
    @{Html.RenderPartial("~/views/KhoKhoHang/_KhoKhoHangListPopup.cshtml", new ViewDataDictionary { { "Html", true }, { "onInitView", "{controllerId:mainCtrl.controllerId.KhoKhoHangListPopup,isSelectOne:true,showTable:true,title:'Kho xuất',userInfo:" + ViewBag.userInfo + "}" } });}
</div>
@section ImportStyles{}
@section SetupStyles{
    <style>
        /*.table .form-control {
            height: auto;
            font-size: 14px;
            padding: 3px;
            width: 100%;
            line-height: 1;
        }*/
        .form-inline {
            padding-left: 0;
        }

            .form-inline .form-group {
                margin-left: 0;
                margin-right: 0;
            }

            .form-inline .form-label {
                font-size: 12px;
            }
    </style>
}
@section ImportScripts{}
@section SetupScripts{}
@section ImportAngular{
    <script src="~/Scripts/angular/app/models/keyCodes.js"></script>
    <script src="~/Scripts/angular/shared/directive/keyboard.directive.js"></script>
    <script src="~/Scripts/angular/TuyChonFormCot/controller/TuyChonCotListCtrl.js"></script>
    <script src="~/Scripts/angular/TuyChonFormCot/service/TuyChonCotService.js"></script>
    <script src="~/Scripts/angular/KhoPhieuXuat/controller/MainEditCtrl.js"></script>
    <script src="~/Scripts/angular/KhoPhieuXuat/controller/KhoPhieuXuatEditCtrl.js"></script>
    <script src="~/Scripts/angular/KhoPhieuXuat/service/KhoPhieuXuatService.js"></script>
    <script src="~/Scripts/angular/KhoHangHoa/controller/KhoHangHoaListPopCtrl.js"></script>
    <script src="~/Scripts/angular/KhoHangHoa/service/KhoHangHoaService.js"></script>
    <script src="~/Scripts/angular/KhachHang/controller/KhachHangListCtrl.js"></script>
    <script src="~/Scripts/angular/KhachHang/service/KhachHangService.js"></script>
    <script src="~/Scripts/angular/NhanVien/List/controller/NhanVienListPopupCtrl.js"></script>
    <script src="~/Scripts/angular/NhanVien/List/service/NhanVienService.js"></script>
    @{Html.RenderPartial("~/views/KhoTaiKhoan/_TaiKhoanListPopup.cshtml", new ViewDataDictionary { { "ImportAngular", true } });}
    @{Html.RenderPartial("~/views/KhoKhoHang/_KhoKhoHangListPopup.cshtml", new ViewDataDictionary { { "ImportAngular", true } });}
    @{Html.RenderPartial("~/views/NhanVien/_NhanVienListPopup.cshtml", new ViewDataDictionary { { "ImportAngular", true } });}
}
