
@{
    ViewBag.Title = "Nhập khẩu";
}

<div class="container-fluid">
    <div ng-controller="TheoDoiListCtrl as ctrl" class="panel panel-default" keyboard="ctrl.keys" ng-init="ctrl.onInitView({userInfo: @ViewBag.userInfo})">
        <div class="panel-heading">
            <div class="panel-title clearfix">
                <span><i class="fa fa-fw fa-star-o"></i>Nhập khẩu tài sản</span>
                <div class="pull-right">
                    <form class="form-inline">
                        <div class="form-group form-group-sm">
                            <div class="input-group input-group-sm">
                                <input class="form-control" id="txtsearch" ng-model="ctrl.data.searchString" ng-keypress="$event.keyCode===13?ctrl.action.getPage():0" autofocus />
                                <span class="input-group-btn">
                                    <button class="btn btn-sm btn-primary" ng-click="ctrl.action.getPage()"><i class="fa fa-fw fa-search"></i>Tìm kiếm (F3)</button>
                                    <a class="btn btn-warning" data-toggle="collapse" data-target="#TuyChonCotPopup"><i class="fa fa-fw fa-cog"></i> Tùy chọn</a>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        <div class="panel-body">
            <h3 class="text-center no-margin">Danh sách nhập khẩu tài sản</h3>
        </div>
        <div class="wrap">
            @*<table class="head">
                <tr>
                    <td class="text-center" style="width: 50px;">Chọn</td>
                    <td class="text-center" style="width: 40px;">STT</td>
                    <td class="text-center" ng-repeat="cot in ctrl.data.listCot|filter:ctrl.action.checkCot">
                        <span ng-bind="::cot.TenCot"></span>
                    </td>
                </tr>
            </table>*@
            <div class="table-container panel-body inner_table">
                <table st-table="ctrl.data.TheoDoiListDisplay" st-pipe="ctrl.action.getPage" class="table fixed_headers table-bordered table-condensed table-responsive table-hover ">
                    <thead class="bg-default text-primary">
                        <tr>
                            <th class="text-center" style="width: 50px;">Chọn</th>
                            <th class="text-center" style="width: 40px;">STT</th>
                            <th class="text-center" ng-repeat="cot in ctrl.data.listCot|filter:ctrl.action.checkCot" ng-switch="cot.MaCot">
                                <span ng-switch-when="TenTaiSan" style="min-width:200px;display:block" ng-bind="cot.TenCot"></span>
                                <span ng-switch-when="NgayTrangCap" style="min-width:110px;display:block" ng-bind="cot.TenCot"></span>
                                <span ng-switch-when="NgayBatDauSuDung" style="min-width:120px;display:block" ng-bind="cot.TenCot"></span>
                                <span ng-switch-when="TenNhanVien" style="min-width:150px;display:block" ng-bind="cot.TenCot"></span>
                                <span ng-switch-default style="min-width:100px;display:block" ng-bind="::cot.TenCot"></span>
                            </th>

                        </tr>
                    </thead>
                    <tbody>
                    @*<tr class="bg-default text-primary">
                        <td class="text-center" style="width: 50px;">Chọn</td>
                        <td class="text-center" style="width: 40px;">STT</td>
                        <td class="text-center" ng-repeat="cot in ctrl.data.listCot|filter:ctrl.action.checkCot">
                            <span ng-bind="::cot.TenCot"></span>
                        </td>
                    </tr>*@
                        <tr ng-if="ctrl.status.isLoading">
                            <td colspan="100" class="text-center">
                                <i class="fa fa-fw fa-spin fa-spinner"></i>
                            </td>
                        </tr>
                        <tr ng-repeat="TheoDoi in ctrl.data.TheoDoiListDisplay" ng-class="(TheoDoi.isSelected==true)?'info':''">
                            <td style="width: 50px;" st-select-row="TheoDoi" st-select-mode="multiple" class="text-center"><i class="fa fa-fw text-primary" ng-class="(TheoDoi.isSelected==true)?'fa-check-square-o':'fa-square-o'"></i></td>
                            <td style="width: 40px;" class="text-center">{{$index + 1}}</td>
                            <td ng-repeat="cot in ctrl.data.listCot|filter:ctrl.action.checkCot" ng-switch="cot.MaCot">
                                <a ng-switch-when="MaTaiSan" ng-bind="TheoDoi.MaTaiSan" ng-click="ctrl.action.edit(TheoDoi.TaiSanId,TheoDoi.PhongBanId,TheoDoi.NhanVienId,TheoDoi.Nam)" href="javascript:void(0);"></a>
                                <a ng-switch-when="TenTaiSan" ng-bind="TheoDoi.TenTaiSan" ng-click="ctrl.action.edit(TheoDoi.TaiSanId,TheoDoi.PhongBanId,TheoDoi.NhanVienId,TheoDoi.Nam)" href="javascript:void(0);"></a>
                                <span ng-switch-when="NgayGhiTang">{{ TheoDoi.NgayGhiTang | date : 'dd/MM/yyyy'}}</span>
                                <span ng-switch-when="NgayTrangCap">{{ TheoDoi.NgayTrangCap | date : 'dd/MM/yyyy'}}</span>
                                <span ng-switch-when="NgayBatDauSuDung">{{ TheoDoi.NgayBatDauSuDung | date : 'dd/MM/yyyy'}}</span>
                                <span style="float:right" ng-switch-when="SLTon">{{ TheoDoi.SLTon|number }}</span>
                                <span style="float:right" ng-switch-when="SLTang">{{ TheoDoi.SLTang|number }}</span>
                                <span style="float:right" ng-switch-when="SLGiam">{{ TheoDoi.SLGiam|number }}</span>
                                <span style="float:right" ng-switch-when="SoLuong">{{ TheoDoi.SoLuong|number }}</span>
                                <span style="float:right" ng-switch-when="NguyenGia">{{ TheoDoi.NguyenGia|number }}</span>
                                <span style="float:right" ng-switch-when="ThanhTien">{{ TheoDoi.ThanhTien|number }}</span>
                                <span ng-switch-default ng-bind="::TheoDoi[cot.MaCot]"></span>
                            </td>

                        </tr>
                    </tbody>
                  
                </table>
            </div>
        </div>
        <div style="clear: both">
            <p class="text-danger text-right" style="padding-right:36px">Tổng tiền : {{ctrl.data.TheoDoiListDisplay|sumOfValue:'ThanhTien'|number}}</p>
        </div>
        <div class="panel-footer">
            <button class="btn btn-sm btn-primary" ng-if="ctrl.data.showButtonNew" ng-click="ctrl.action.add()"><i class="fa fa-plus"></i> Mới (F2)</button>&nbsp;&nbsp;&nbsp;
            <button class="btn btn-sm btn-danger" ng-if="ctrl.data.showButtonXoaChon" ng-click="ctrl.action.deleteSelected()"><i class="fa fa-trash-o"></i> Xóa chọn</button>
        </div>
    </div>

    <!-- popup danh sách tùy chọn cột -->
    <div class="panel panel-primary ui-draggable collapse fade" id="TuyChonCotPopup" ng-controller="TuyChonCotListCtrl as ctrl" ng-init="ctrl.onInitView({userInfo: @ViewBag.userInfo,controllerId:'TuyChonCotPopup',MaForm:'FL0022'})">
        <div class="panel-heading ui-draggable-handle">
            <div class="panel-title">
                <span>Tùy chọn cột</span>
                <a class="btn btn-xs btn-primary pull-right" data-toggle="collapse" data-target="#TuyChonCotPopup"><i class="fa fa-remove"></i></a>
            </div>
        </div>
        <div class="table-responsive" style="width: 400px; height: auto;" ng-if="ctrl.data.showList">
            <table class="table table-bordered table-condensed table-hover table-striped" st-table="ctrl.data.listCot">
                <thead>
                    <tr>
                        <th style="width: 65px;">Hiện/ẩn</th>
                        <th>Tên cột</th>
                        <th>Độ rộng</th>
                    </tr>
                </thead>
                <tbody style="height:100px;">
                    <tr ng-repeat="cot in ctrl.data.listCot" ng-class="(cot.isSelected==true)?'info':''" ng-init="cot.isSelected=cot.HienThiYN">
                        <td st-select-row="cot" st-select-mode="multiple" class="text-center"><i class="fa fa-fw text-primary" ng-class="(cot.isSelected==true)?'fa-check-square-o':'fa-square-o'"></i></td>
                        <td><span ng-bind="cot.TenCot"></span></td>
                        <td><span ng-bind="cot.DoRong"></span></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="100" class="text-center">
                            <div st-pagination="" st-items-by-page="10" st-template="~/Scripts/angular/shared/smart-table/template/pagination.custom.html"></div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="panel-footer">
            <a class="btn btn-sm btn-primary" ng-click="ctrl.action.apDung()">Áp dụng</a>
            <a class="btn btn-sm btn-default" data-toggle="collapse" data-target="#TuyChonCotPopup">Đóng</a>
        </div>
    </div>
    <!-- / popup danh sách tùy chọn cột -->

</div>

<div ng-controller="TheoDoiEditCtrl as ctrl" class="panel panel-primary ui-draggable collapse fade" id="TheoDoiEditPopup" keyboard="ctrl.keys" ng-init="ctrl.onInitView({userInfo: @ViewBag.userInfo})">
    <div class="panel-heading ui-draggable-handle">
        <h2 class="panel-title">
            <span>Thông tin tồn kho </span>
            <a class="btn btn-xs btn-primary pull-right" data-toggle="collapse" data-target="#TheoDoiEditPopup" ng-click="ctrl.action.close()">
                <i class="fa fa-remove"></i>
            </a>
            <i class="fa fa-fw fa-pulse text-primary pull-right fa-spinner" ng-if="ctrl.status.isLoading"></i>
        </h2>
    </div>
    <div style="width: 600px; padding-top: 15px;padding-right: 50px;">
        <form class="form-horizontal">
            
            <div class="row form-group form-group-sm" ng-class="(ctrl.validate.MaTaiSan)?'has-error':''">
                <label class="control-label col-sm-3">Mã tài sản</label>
                <div class="col-sm-9">
                    <input type="text" id="txtMaTaiSan" class="form-control text-left" ng-model="ctrl.data.objTheoDoi.MaTaiSan" ng-keypress="ctrl.action.keyPress(ctrl.data.objTheoDoi.MaTaiSan,'txtMaTaiSan','txtngayghitang',$event)" />
                </div>
            </div>
            <div class="row form-group form-group-sm" ng-class="(ctrl.validate.TaiSanId)?'has-error':''">
                <label class="control-label col-sm-3">Tài sản</label>
                <div class="col-sm-9"> 
                    <cbo-tai-san id="cbxTaiSan" data-function-code="CN0026" data-value="ctrl.data.objTheoDoi.TaiSanId" ma-tai-san="ctrl.data.objTheoDoi.TempMaTaiSan" data-config="{userInfo:@(ViewBag.userInfo)}" template-url="~/taisan/showview?viewname=cbotaisan"
                                 on-selected="ctrl.action.getDataTaiSan(data)"></cbo-tai-san>
                </div>
            </div>
            <div class="row form-group form-group-sm" ng-class="(ctrl.validate.NgayGhiTang)?'has-error':''">
                <label class="control-label col-sm-3">Ngày ghi tăng</label>
                <div class="col-sm-9">
                    <input type="text" id="txtngayghitang" class="form-control datetimepicker date" placeholder="dd/mm/yyyy" ng-model="ctrl.data.objTheoDoi.NgayGhiTang" ng-keypress="ctrl.action.keyPress(ctrl.data.objTheoDoi.NgayGhiTang,'txtngayghitang','txtngaytrangcap',$event)" />
                </div>
            </div>
            <div class="row form-group form-group-sm" ng-class="(ctrl.validate.NgayTrangCap)?'has-error':''">
                <label class="control-label col-sm-3">Ngày trang cấp</label>
                <div class="col-sm-9">
                    <input type="text" id="txtngaytrangcap" class="form-control datetimepicker date" placeholder="dd/mm/yyyy" ng-model="ctrl.data.objTheoDoi.NgayTrangCap" ng-keypress="ctrl.action.keyPress(ctrl.data.objTheoDoi.NgayTrangCap,'txtngaytrangcap','txtngaybatdausudung',$event)"/>
                </div>
            </div>
            <div class="row form-group form-group-sm" ng-class="(ctrl.validate.NgayBatDauSuDung)?'has-error':''">
                <label class="control-label col-sm-3">Ngày BĐ sử dụng</label>
                <div class="col-sm-9">
                    <input type="text" id="txtngaybatdausudung" class="form-control datetimepicker date" placeholder="dd/mm/yyyy" ng-model="ctrl.data.objTheoDoi.NgayBatDauSuDung" ng-keypress="ctrl.action.keyPress(ctrl.data.objTheoDoi.NgayBatDauSuDung,'txtngaybatdausudung','cbxPhongBan',$event)"/>
                </div>
            </div>
            <div class="row form-group form-group-sm" ng-class="(ctrl.validate.PhongBanId)?'has-error':''">
                <label class="control-label col-sm-3">Bộ phận</label>
                <div class="col-sm-9">
                    <cbo-phong-ban id="cbxPhongBan" data-function-code="CN0026" data-value="ctrl.data.objTheoDoi.PhongBanId" data-config="{userInfo:@(ViewBag.userInfo)}" template-url="~/phongban/showview?viewname=cbophongban"
                                   on-selected="ctrl.action.resetNhanVienId(data)"></cbo-phong-ban>
                </div>
            </div>
            <div class="row form-group form-group-sm" ng-class="(ctrl.validate.NhanVienId)?'has-error':''">
                <label class="control-label col-sm-3">Cán bộ</label>
                <div class="col-sm-9">
                    <cbo-nhan-vien-by-phong-ban id="cbxNhanVien" data-value="ctrl.data.objTheoDoi.NhanVienId" data-phongbanid="ctrl.data.objTheoDoi.PhongBanId" data-config="{userInfo:@(ViewBag.userInfo)}" template-url="~/nhanvien/showview?viewname=cbonhanvienbyphongban"
                                   on-selected="ctrl.action.nhanVienByPhongBanSelected(data)"></cbo-nhan-vien-by-phong-ban>
                </div>
            </div>
            <div class="row form-group form-group-sm" ng-class="(ctrl.validate.SLTon)?'has-error':''">
                <label class="control-label col-sm-3">Số lượng</label>
                <div class="col-sm-9">
                    <input type="text" id="txtSLTon" class="form-control text-right" ng-model="ctrl.data.objTheoDoi.SLTon" number-format />
                </div>
            </div>
        </form>
    </div>
    <div class="panel-footer">
        <button type="button" class="btn btn-sm btn-primary" id="btnluu" ng-if="ctrl.data.showButtonSave" ng-click="ctrl.action.save()"><i class="fa fa-save"></i> Lưu (F8)</button>&nbsp;&nbsp;&nbsp;
        <button type="button" class="btn btn-sm btn-default" ng-click="ctrl.action.refresh()">Thiết lập lại</button>&nbsp;&nbsp;&nbsp;
        <button type="button" class="btn btn-sm btn-default" ng-click="ctrl.action.close()">Đóng</button>
    </div>
</div>

@section ImportStyles{}
@section SetupStyles{
    <style type="text/css">

        .wrap {
            width: auto;
        }

        .wrap table {
            width: auto;
            table-layout: fixed;
        }

        /*table tr td {
            padding: 5px;
            border: 1px solid #eee;
            width: 250px;
            word-wrap: break-word;
        }

        table.head tr td {
           background-color: #f5f5f5;
           color: #337ab7;
           font-size: 14px;
           font-weight:bold;
        }*/

        .inner_table {
            height: 400px;
            overflow-y: auto;
            overflow-x: auto;
        }
    </style>
}
@section ImportScripts{}
@section SetupScripts{}
@section ImportAngular{
    <script src="~/Scripts/angular/TheoDoi/service/TheoDoiService.js"></script>
    <script src="~/Scripts/angular/TheoDoi/controller/TheoDoiListCtrl.js"></script>
    <script src="~/Scripts/angular/TheoDoi/controller/TheoDoiEditCtrl.js"></script>
    <script src="~/Scripts/angular/TuyChonFormCot/controller/TuyChonCotListCtrl.js"></script>
    <script src="~/Scripts/angular/TuyChonFormCot/service/TuyChonCotService.js"></script>
    @{Html.RenderPartial("~/views/PhongBan/Combobox.cshtml", new ViewDataDictionary { { "ImportAngular", true } });}
    @{Html.RenderPartial("~/views/NhanVien/Combobox.cshtml", new ViewDataDictionary { { "ImportAngular", true } });}
    @{Html.RenderPartial("~/views/TaiSan/cboTaiSan.cshtml", new ViewDataDictionary { { "ImportAngular", true } });}
    @{Html.RenderPartial("~/views/PhongBan/cboPhongBan.cshtml", new ViewDataDictionary { { "ImportAngular", true } });}
    @{Html.RenderPartial("~/views/NhanVien/cboNhanVienByPhongBan.cshtml", new ViewDataDictionary { { "ImportAngular", true } });}

}




