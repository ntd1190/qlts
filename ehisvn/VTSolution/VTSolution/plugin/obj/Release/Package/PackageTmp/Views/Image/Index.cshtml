@{
    ViewBag.Title = "Danh Sách Hình Ảnh Song Ân ";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}



@(Html.Kendo().Grid<VTSolution.ViewModel.Manager.ImageDetailModel>()
    .Name("grid")
    .Columns(columns =>
    {

        columns.Bound(p => p.ImagePath).HeaderHtmlAttributes(new { style = "text-align:center" }).Width(200).Title("Hình ảnh").ClientTemplate("<img style='width:100%; height:200px;'src='#=ImagePath#' />");
        columns.Template(@<text></text>).ClientTemplate("<input type='checkbox' name='#=Id#' class='delselect'  />").Title("del").Width(15).HeaderHtmlAttributes(new { style = "text-align:center" });
        columns.Command(command =>
        {
            //command.Edit().Text("Vị Trí");
            command.Destroy().Text("Xóa");
        }).Width(172);
    })
       .ToolBar(toolbar =>
                {


                    toolbar.Template(@<text>

                        <div class="row">
                            <div class="col-md-3">
                                @(Html.Kendo().Button()
                                    .Name("btn_Add")
                                    .Icon("plus")
                                    .Content("Thêm mới")
                                            .Events(e => e.Click("addClick"))
                                )
                            </div>
                            <div class="col-md-3">
                                @(Html.Kendo().Button()
                                    .Name("btn_dele")
                                    .Icon("plus")
                                    .Content("Xóa Chọn")
                                            .Events(e => e.Click("DeleteClick"))
                                )
                            </div>
                            <div class="col-md-4">
                                @(Html.Kendo().DropDownList()
                                .Name("Name")
                                           .HtmlAttributes(new { style = "width:359px" })
                                                  .OptionLabel("Album")
                                                          .DataTextField("Vi_Name")
                                                  .DataValueField("Id")
                                                 .AutoBind(false)
                                                 .Events(e => e.Change("menumajorChange"))
                                                  .Filter(FilterType.Contains)
                                                           .DataSource(source =>
                                                      {
                                                          source.Read(read =>
                                                          {
                                                              read.Action("GetCategory", "Image");
                                                          });
                                                      })
                                )
                            </div>

                        </div>
                    </text>);
                })
              .Editable(editable => editable.Mode(GridEditMode.PopUp))
    .Pageable(pageable => pageable
    .Refresh(true)
    .PageSizes(true)
    .ButtonCount(10))
    .Sortable()
    .Scrollable()
    .Resizable(resize => resize.Columns(true))
    .HtmlAttributes(new { style = "height:1000px;" })
    .DataSource(dataSource => dataSource
        .Ajax()
        .PageSize(20)

        .Model(model => model.Id(p => p.Id))

                          .Read(read => read.Action("Image_Read", "Image"))
                                       // .Update(update => update.Action("Image_Update", "Image"))
                                          .Destroy(update => update.Action("Image_Destroy", "Image"))
    )
)
<div class="modal fade" id="waiting" class="centered" tabindex="-1" role="dialog" aria-labelledby="contactLabel" aria-hidden="false">
    <button class="btn btn-lg btn-warning centered"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Vui lòng chờ trong giây lát...</button>
</div>
<style>
    .centered {
        position: fixed;
        top: 50%;
        left: 50%;
        margin-top: -50px;
        margin-left: -100px;
    }
</style>
<script>

    function menumajorChange() {
        var value = this.value();
        grid = $("#grid").data("kendoGrid");
        if (value) {
            grid.dataSource.filter({ field: "GroupId", operator: "eq", value: parseInt(value) });

        } else {
            grid.dataSource.filter({});
        }
    }
    function addClick() {
        window.location.href = "/vi/Image/Create/0";
    }

    function DeleteClick() {
        $('#waiting').modal('show');
        var del = [];
        $('input:checkbox.delselect').each(function () {
            if ($(this).is(":checked")) {
                var name = $(this).attr('name');
                del.push({
                    Id: name
                });
             
            }
        });
        $.ajax({
            url: '@Url.Action("DelAll", "Image")',
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "text",
            data: JSON.stringify({ del: del }),
            success: function () {
                $('#waiting').modal('hide');
                window.location.reload();
            }
        });
    }
</script>
